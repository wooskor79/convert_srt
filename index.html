<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>í†µí•© ìë§‰ ë³€í™˜ê¸°</title>
<link rel="stylesheet" href="style.css">
</head>

<body>

<div class="wrapper">
  <div class="card">

    <button id="theme-toggle" class="theme-toggle-btn">
      <span>ğŸŒ™</span> ëª¨ë“œ ë³€ê²½
    </button>

    <h1>í†µí•© ìë§‰ ë³€í™˜ê¸°</h1>
    <div class="subtitle">
      SMI, SRT, IDX+SUB ì§€ì› Â· ì„œë²„ì— íŒŒì¼ ì €ì¥ ì•ˆ í•¨
    </div>

    <div class="steps">
      <div class="step active"><span>1</span><p>íŒŒì¼ ì„ íƒ</p></div>
      <div class="step"><span>2</span><p>ì˜µì…˜ ì„¤ì •</p></div>
      <div class="step"><span>3</span><p>ë³€í™˜</p></div>
      <div class="step"><span>4</span><p>ë‹¤ìš´ë¡œë“œ</p></div>
    </div>

    <div class="dropzone" id="dropzone">
      <strong>íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</strong>
      <small>ì—¬ëŸ¬ íŒŒì¼ ë™ì‹œ ì„ íƒ ê°€ëŠ¥ (.srt, .smi, .idx, .sub)</small>
      <input type="file" id="files" multiple accept=".srt,.smi,.idx,.sub">
    </div>

    <div class="options">
      <label class="option active">
        <input type="radio" name="mode" value="smi2srt" checked>
        SMI â†’ SRT
      </label>
      <label class="option">
        <input type="radio" name="mode" value="srt2smi">
        SRT â†’ SMI
      </label>
      <label class="option">
        <input type="radio" name="mode" value="idx2srt">
        IDX+SUB â†’ SRT
      </label>
    </div>

    <div class="actions">
      <button id="start">ë³€í™˜í•˜ê¸°</button>
    </div>

    <div id="log"></div>

  </div>
</div>

<script>
/* -----------------------------------------------------------
   1. ë‹¤í¬ ëª¨ë“œ ë¡œì§ (ì €ì¥ ê¸°ëŠ¥ í¬í•¨)
----------------------------------------------------------- */
const themeToggleBtn = document.getElementById('theme-toggle');
const htmlEl = document.documentElement;

// ì´ˆê¸° í…Œë§ˆ ì„¤ì •
function initTheme() {
  const savedTheme = localStorage.getItem('theme');
  const systemDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
  
  // ì €ì¥ëœ ê°’ì´ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš©, ì—†ìœ¼ë©´ ì‹œìŠ¤í…œ ì„¤ì • í™•ì¸
  let theme = savedTheme ? savedTheme : (systemDark ? 'dark' : 'light');
  applyTheme(theme);
}

// í…Œë§ˆ ì ìš© í•¨ìˆ˜
function applyTheme(theme) {
  htmlEl.setAttribute('data-theme', theme);
  
  if (theme === 'dark') {
    themeToggleBtn.innerHTML = '<span>â˜€ï¸</span> ë¼ì´íŠ¸ ëª¨ë“œ';
  } else {
    themeToggleBtn.innerHTML = '<span>ğŸŒ™</span> ë‹¤í¬ ëª¨ë“œ';
  }
}

// ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
themeToggleBtn.addEventListener('click', () => {
  const current = htmlEl.getAttribute('data-theme');
  const next = current === 'dark' ? 'light' : 'dark';
  
  applyTheme(next);
  localStorage.setItem('theme', next);
});

// ì‹¤í–‰
initTheme();


/* -----------------------------------------------------------
   2. íŒŒì¼ ì—…ë¡œë“œ ë° ë³€í™˜ ë¡œì§
----------------------------------------------------------- */
const dropzone = document.getElementById('dropzone');
const fileInput = document.getElementById('files');
const log = document.getElementById('log');

/* Drag & Drop */
dropzone.addEventListener('dragover', e => {
  e.preventDefault();
  dropzone.classList.add('dragover');
});
dropzone.addEventListener('dragleave', () => {
  dropzone.classList.remove('dragover');
});
dropzone.addEventListener('drop', e => {
  e.preventDefault();
  dropzone.classList.remove('dragover');
  fileInput.files = e.dataTransfer.files;
});

/* ì˜µì…˜ UI */
document.querySelectorAll('.option').forEach(opt => {
  opt.addEventListener('click', () => {
    document.querySelectorAll('.option').forEach(o => o.classList.remove('active'));
    opt.classList.add('active');
    opt.querySelector('input').checked = true;
  });
});

/* ë³€í™˜ ìš”ì²­ */
document.getElementById('start').addEventListener('click', async () => {
  if (!fileInput.files.length) {
    alert('íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”');
    return;
  }

  log.textContent = 'ì—…ë¡œë“œ ë° ë³€í™˜ ì‹œì‘...\n(IDXë³€í™˜ì€ ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤)\n';

  const formData = new FormData();
  [...fileInput.files].forEach(f => formData.append('files[]', f));
  formData.append(
    'mode',
    document.querySelector('input[name="mode"]:checked').value
  );

  try {
    const res = await fetch('upload.php', { method: 'POST', body: formData });
    const data = await res.json();
    
    log.textContent = '';
    if (data.logs) data.logs.forEach(l => log.textContent += l + '\n');

    if (data.success && data.zip) {
      log.textContent += 'ì™„ë£Œ! ë‹¤ìš´ë¡œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.\n';
      window.location = data.zip;
    } else {
      log.textContent += 'ë³€í™˜ ì‹¤íŒ¨ ë˜ëŠ” ê²½ê³ ê°€ ìˆìŠµë‹ˆë‹¤.\n';
    }
  } catch (err) {
    log.textContent += 'ì„œë²„ í†µì‹  ì˜¤ë¥˜: ' + err.message + '\n';
  }
});
</script>

</body>
</html>